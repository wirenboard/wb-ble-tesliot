# wb-ble-tesliot
TESLiOT BLE Sensors <==> MQTT bridge. It's designed to be used on Wiren Board family of programmable automation controllers. Based on script for wb-rules engine.

Драйвер датчиков TESLiOT, работающих через канал BLE GAP Advertising. Предназначен для контроллеров Wiren Board и основан на правиле для движка wb-rules.

## Общая информация
Беспроводные датчики TESLiOT имеют на борту разнообразные датчики состояния среды и имеют заявленный батарейное питание со сроком работы от батареи от 6 месяцев до трёх лет в зависимости от типа.

Протокол подразумевает возможность получать такие данные как:
* Напряжение питания датчика
* Факт удара
* Ускорения по осям X, Y и Z
* Интенсивность магнитного поля
* Освещённость
* Влажность
* Температура
* Метка времени в момент передачи данных

## Подключение к контроллеру Wiren Board
Датчики TESLiOT подключаются к контроллерам Wirenboard по каналу BLE посредством широковещания параметров GAP Advertising. Со стороны контроллера движок правил wb-rules периодически запускает скрипт сканирования сети, от которого получает свежие данные с датчиков.

## Установка и настройка
Драйвер устанавливается из репозитория Wiren Board.
```
apt update
apt install wb-ble-tesliot
```
Далее нужно в конфигурационном файле `/etc/wb-ble-tesliot.conf` заполнить массив датчиков, указав их mac-адреса (mac), желаемые названия mqtt-топиков (dev_id) и заголовки виртуальных устройств (title):

```
{"config":
   [
      {
         "dev_id":"tesliot_1", // устройство будет доступно по топику /devices/tesliot_1
         "title":"TESLiOT Test Sensor 1", // видимое имя устройства
         "mac":"FF:FF:FF:FF:FF:FF" // mac-адрес устройства
      },
      {
         "dev_id":"tesliot_2",
         "title":"TESLiOT Test Sensor 2",
         "mac":"FE:FE:FE:FE:FE:FE"
      }
   ]
}
```

Затем нужно перезапустить wb-rules.
```
systemctl restart wb-rules
```

После этого в списке устройств появятся устройства с соответствующими id и заголовками.
